# Руководство пользователя ESP32 UART to Bluetooth SPP Bridge (BTProxy)

**Версия прошивки:** 1.0

## 1. Обзор

Эта прошивка превращает модуль ESP32 в прозрачный мост между интерфейсом UART (последовательный порт) и классическим устройством Bluetooth, использующим профиль последовательного порта (SPP). Она позволяет устройству, подключенному через UART, обмениваться данными с удаленным устройством Bluetooth так, как если бы они были соединены последовательным кабелем.

Прошивка имеет два режима работы:
*   **Режим прокси (Proxy Mode):** Режим по умолчанию. ESP32 автоматически подключается к предварительно настроенному удаленному устройству Bluetooth и прозрачно пересылает все данные между UART и Bluetooth-соединением.
*   **Командный режим (Command Mode):** Интерактивный режим, который позволяет настраивать параметры удаленного устройства Bluetooth (MAC-адрес и PIN-код) через интерфейс UART.

## 2. Требования к оборудованию

*   **Плата разработки ESP32** с поддержкой классического Bluetooth (подходит большинство стандартных модулей ESP32).
*   Кнопка "Boot" (подключенная к GPIO 0) используется для переключения между режимами прокси и командным режимом.

## 3. Настройки UART (последовательного порта)

Для связи с модулем ESP32 (особенно в командном режиме) необходимо настроить ваш серийный терминал или хост-устройство со следующими параметрами:

*   **Скорость (Baud Rate):** 115200
*   **Биты данных (Data Bits):** 8
*   **Четность (Parity):** Нет (None)
*   **Стоповые биты (Stop Bits):** 1
*   **Управление потоком (Flow Control):** Нет (None)

## 4. Шаги по настройке

Чтобы настроить соединение с вашим целевым устройством Bluetooth, необходимо войти в командный режим и выполнить несколько команд.

### Шаг 1: Вход в командный режим

1.  Подключите ESP32 к компьютеру через USB.
2.  Откройте серийный терминал с настройками, указанными в разделе 3.
3.  Нажмите и удерживайте кнопку **"Boot"** (GPIO 0) на плате ESP32 примерно одну секунду.
4.  Устройство сообщит об изменении режима в серийном терминале:
    ```
    %ESP32_BTP% CMD MODE: ENABLED
    ```
    Теперь устройство готово принимать команды.

### Шаг 2: Сканирование устройств (необязательно, но рекомендуется)

Чтобы найти MAC-адрес вашего целевого устройства Bluetooth, используйте команду `SCAN`.

```
SCAN
```

ESP32 выполнит 10-секундное сканирование ближайших классических устройств Bluetooth и выведет их MAC-адреса, имена и сервисы.

Пример вывода:
```
%ESP32_BTP% INFO: Scanning, please wait...
%ESP32_BTP%  SCAN: found 01:23:45:67:89:AB
...
%ESP32_BTP% INFO: Found devices:
%ESP32_BTP% INFO: Address: 01:23:45:67:89:AB  Name: [MyBTDevice]  RSSI: -55
%ESP32_BTP% INFO:        Services found: 1
%ESP32_BTP% INFO:        channel 1 (SPP)
```
Скопируйте MAC-адрес вашего целевого устройства (например, `01:23:45:67:89:AB`).

### Шаг 3: Настройка параметров подключения

Используйте команды `SETADDR` и `SETPIN` для сохранения учетных данных удаленного устройства.

1.  **Установка MAC-адреса:**
    ```
    SETADDR XX:XX:XX:XX:XX:XX
    ```
    Замените `XX:XX:XX:XX:XX:XX` на адрес, который вы нашли при сканировании.
    Пример: `SETADDR 01:23:45:67:89:AB`

2.  **Установка PIN-кода:**
    ```
    SETPIN YYYY
    ```
    Замените `YYYY` на PIN-код удаленного устройства.
    Пример: `SETPIN 1234`

Настройки сохраняются автоматически в энергонезависимую память ESP32.

### Шаг 4: Проверка конфигурации (необязательно)

Используйте команду `INFO` для проверки текущих сохраненных настроек.

```
INFO
```

### Шаг 5: Выход из командного режима

Чтобы запустить прокси, выйдите из командного режима, снова нажав кнопку **"Boot"**. Устройство сообщит об изменении режима:

```
%ESP32_BTP% CMD MODE: DISABLED
```

В качестве альтернативы можно просто перезагрузить ESP32. После этого устройство автоматически попытается подключиться к настроенному удаленному устройству.

## 5. Справочник по командам

Все команды должны завершаться символом новой строки (нажатием Enter).

*   `HELP`: Выводит список доступных команд.
*   `SCAN`: Сканирует ближайшие классические устройства Bluetooth.
*   `SETADDR <address>`: Устанавливает и сохраняет MAC-адрес удаленного устройства.
*   `SETPIN <pin>`: Устанавливает и сохраняет PIN-код для удаленного устройства.
*   `INFO`: Отображает текущую сохраненную конфигурацию.
*   `CLEAR`: Сбрасывает конфигурацию до значений по умолчанию.

При вводе неизвестной команды устройство покажет сообщение об ошибке.
```
%ESP32_BTP% ERROR: unknown command [ваша_команда], type HELP for help
```
